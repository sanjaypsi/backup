WITH ordered AS (
  SELECT *, ROW_NUMBER() OVER (
      ORDER BY group_1 ASC  -- Default set sort field here
  ) AS _order
  FROM (
    SELECT b.*
    FROM (
      SELECT project, root, group_1, relation, phase, MAX(modified_at_utc) AS modified_at_utc
      FROM t_review_info
      WHERE project = 'potoodev' AND root = 'assets' AND deleted = 0   -- < set filters here
      GROUP BY project, root, group_1, relation, phase
    ) AS a
    LEFT JOIN (
      SELECT root, project, group_1, phase, relation, work_status, submitted_at_utc, modified_at_utc, executed_computer
      FROM t_review_info  -- < set required fields here
      WHERE project = 'potoodev' AND root = 'assets' AND deleted = 0   -- < set filters here
    ) AS b
      ON a.project = b.project
     AND a.root = b.root
     AND a.group_1 = b.group_1
     AND a.relation = b.relation
     AND a.phase = b.phase
     AND a.modified_at_utc = b.modified_at_utc
    ORDER BY submitted_at_utc ASC     -- set sort field here
  ) AS k
),
offset_ordered AS (
  SELECT c.*,
         CASE WHEN c.phase = '' THEN c._order ELSE 100000 + c._order END AS __order  -- < phase param here
  FROM ordered c
),
ranked AS (
  SELECT b.*,
         ROW_NUMBER() OVER (
           PARTITION BY b.root, b.project, b.group_1, b.relation
           ORDER BY CASE WHEN b.phase = '' THEN 0 ELSE 1 END  -- < phase param again
         ) AS _rank
  FROM offset_ordered b
)
SELECT root, project, group_1, relation, phase, work_status
FROM ranked
WHERE _rank = 1
ORDER BY __order ASC
LIMIT 60 OFFSET 0;



select b.* from (
select root, project, group_1, phase, relation, max(modified_at_utc) as modified_at_utc from t_review_info

where (root, project, group_1, relation) in (
('assets', 'potoodev', 'testAssetA', 'com'),
('assets', 'potoodev', 'camHero', 'com'))

group by project, root, group_1, phase, relation) as a
left join  t_review_info as b
on a.root = b.root and a.project = b.project and a.group_1 = b.group_1 and a.phase = b.phase and a.relation = b.relation and a.modified_at_utc = b.modified_at_utc;
